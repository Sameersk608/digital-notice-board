<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="assets/css/teacher.css">
    <title>Document</title>
</head>
<body>
    <div id="add">
        <h1><u>Add Notification</u></h1>
        <form action="addN.php" method="post">
        <table>
            <tr>
                <th>Posted By </th>
                <th><input list="teacher" name="by" id="selT">

                    <datalist id="teacher">
                    <option value="Santosh Katti"></option>
                    <option value="Dr Lekha A"></option>
                    <option value="Tamal Dey"></option>
                    <option value="Premlatha HM"></option>
                    <option value="Thenmozhi S"></option>
                    <option value="Archana A"></option>
                    <option value="Srinivas S"></option>
                    <option value="Sujeeth"></option>
                </datalist></th>
            </tr>
            <tr>
                <th>Posted For</th>
                <th><input list="forSt" name="forSt" id="selFor">

                    <datalist id="forSt">
                    <option value="MCA 1 sem"></option>
                    <option value="MCA 2 sem"></option>
                    <option value="MCA 3 sem"></option>
                    <option value="MCA 4 sem"></option>
                </datalist></th>
            </tr>
            <tr>
                <th>Meta Info</th>
                <th><input type="text" name="meta" id=""></th>
            </tr>
            <tr>
                <th>Category</th>
                <th><input list="catsSel" name="cats" id="catts">

                    <datalist id="catsSel">
                    <option value="Placements"></option>
                    <option value="Registration"></option>
                    <option value="Exams and Practical Schedule"></option>
                    <option value="Extra Curricular Activities"></option>
                </datalist></th>
            </tr>
            <tr>
                <th>Title</th>
                <th><input type="text" name='title'></th>
            </tr>
            <tr>
                <th>Description</th>
                <th><textarea name="desc" id="" cols="30" rows="10"></textarea></th>
            </tr>
            <tr>
                <th>Links</th>
                <th><input type="text"  
                    pattern="https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)"
                    name="links" id=""></th>
            </tr>
            <tr>
                <th>Expiry</th>
                <th><input type="date" name="expiry" id="expiry" min='2021-01-01' max='2022-12-31'></th>
            </tr>
        </table>
        <button type="submit">ADD</button>
    </form>
   </div>
   <br><br><br><br><br>
    <div id="edit"style="position: relative;">
         <h1><u>Edit Notification</u></h1>
            <label for="sellab">Choose Notification ID</label>
            <div style="position:relative;float:right;" id="sellab">
                <select id="notifs">
                
            </select>
        </div>
        <form action="editChangesMade.php" method="post">
        <table>
            <tr>
                <th>ID</th>
                <th><input name="idNot" type="text" id="editId" ></th>
            </tr>
            <tr>
                <th>Posted By </th>
                <th><input type="text" name ='by' id="editBy"></th>
            </tr>
            <tr>
                <th>Posted For</th>
                <th><input type="text" name="for" id="editFor"></th>
            </tr>
            <tr>
                <th>Meta Info</th>
                <th><input type="text" name="meta"  id="editMeta"></th>
            </tr>
            <tr>
                <th>Category</th>
                <th><select name="category" id="editCategory">
                    <option selected value="Placements">Placements</option>
                    <option value="Academics">Academics</option>
                    <option value="Registration">Registration</option>
                    <option value="Extra Curricular">Extra Curricular</option>
                </select></th>
            </tr>
            <tr>
                <th>Title</th>
                <th><input type="text" name='title' id="editTitle"></th>
            </tr>
            <tr>    
                <th>Description</th>
                <th><textarea name='desc' cols="30" id="editDescription" rows="10"></textarea></th>
            </tr>
            <tr>
                <th>Links</th>
                <th><input type="text" name="link"  id="editLink"></th>
            </tr>
            <tr>
                <th>Expiry</th>
                <th><input type="date" name="expiry" id="editExpiry"></th>
            </tr>
        </td>
        <td>
        </table>
        <button type="submit">UPDATE</button>
    </form>
   </div>
    <div id="delete">
        <h1><u>Delete Notification</u></h1>
        <div class="chips" id="cates">
          
            <div class="chip">MCA 4 Sem</div>
            <div class="chip">MCA 2 Sem</div>
            <div class="chip">MCA 1 Sem</div>
            <div class="chip">MCA 3 Sem</div>
        </div>
        <br>
        <br>
        <table style="width:90%;" id="tableCat">
                <tr>
                    <th style="text-align: center;" colspan="5" id="cate">BCA 1st Sem</th>
                </tr>
                <tr>
                    <th>Category</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Expiry</th>
                    <th>Delete</th>
                </tr>
        </table>
    </div>
    <div id="view">
        <h1><u>View Notification</u></h1>
       <div id="appendable">

       </div>
    </div>
    <script>
        function writeToP(d){
            let app=document.getElementById('appendable');
            if(d.length==0){
                app.innerHTML="<p>Nothing To Show</p>"
            }
            else{
                txt=''
                app.innerHTML=" ";
               for(i=0;i<d.length;i++){
                   a=d[i]
                    txt+=`
                    <h3>
                        ID : ${a['id']}  <br>
                        POSTED BY : ${a['byName']} <br>
                        FOR BATCH : ${a['forName']} <br>
                        CATEGORY  : ${a['category']} <br>
                        DESCRIPTION  : ${a['description']} <br>
                        TITLE  : ${a['title']} <br>
                        LINK  : ${a['link']} <br>
                        META  : ${a['meta']} <br>
                        DUE DATE  : ${a['expiry']} <br>
                        </h3>
                        <hr>
                    `;
               }
               app.innerHTML=txt;
            }
        }

        function deleteNoti(id)
        {
            document.getElementById(id).remove()
            let formData = new FormData();
            formData.append('id', id);
            fetch('delete.php',{method:"POST",body:formData})
            .then(res=>res.json())
            .then(d=>d==1?alert("Deleted"):alert("Error Deleting"))
        }
        function createTable(d,e){
            let table=document.getElementById('tableCat');
            table.innerHTML=` <tr>
                    <th style="text-align: center;" colspan="5" id="cate">BCA 1st Sem</th>
                </tr>
                <tr>
                    <th>Category</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Expiry</th>
                    <th>Delete</th>
                </tr>`;
                appd=document.getElementById('cate').innerText=e
            for(j=0;j<d.length;j++){
                t=d[j]
                console.log(t)
                var row = table.insertRow(j+1);
                row.setAttribute('id',t['id'])
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                cell1.innerHTML = t['category'];
                cell2.innerHTML = t['title'];
                cell3.innerHTML = t['description'];
                cell4.innerHTML = t['expiry'];
                cell5.innerHTML= `<button  onclick='deleteNoti(${t['id']})'>X</button>`;
            }
        }

        function writeToForm(d){
           d=d[0]
           // console.log(d)
           document.getElementById('editId').value=d['id'] 
           document.getElementById('editBy').value=d['byName']
            document.getElementById('editFor').value=d['forName']
            document.getElementById('editMeta').value=d['meta']
            document.getElementById('editCategory').value=d['category']
            document.getElementById('editTitle').value=d['title']
           document.getElementById('editLink').value=d['link']
            document.getElementById('editExpiry').value=d['expiry']
            document.getElementById('editDescription').innerText=d['description']
        }

        parent=document.getElementById('cates')
        parent.addEventListener("click",(e)=>{
            appd=document.getElementById('cate')
            appd.innerText=e.target.innerText;
            let formData = new FormData();
            formData.append('for', appd.innerText);
            fetch('showDeleteable.php',{method:"POST",body:formData})
            .then(res=>res.json())
            .then(d=>createTable(d,e.target.innerText))
        })

    fetch('count.php')
    .then(res=>res.json())
    .then(d=>{
        let notifs=document.getElementById('notifs')
        for(let i=1;i<=Number(d);i++){
            let option=document.createElement('OPTION');
            option.setAttribute('value',i);
            var text = document.createTextNode(i);
            option.appendChild(text)
            notifs.appendChild(option);
        }
    })     

    fetch('viewAll.php')
    .then(res=>res.json())
    .then(d=>writeToP(d))
    
    notifs.onchange=(e)=>{
        let id = notifs.value;
        let formData = new FormData();
        formData.append('id', id);
        fetch('postIdForEdit.php',{method:"POST",body:formData})
        .then(res=>res.json())
        .then(d=>writeToForm(d))
    }


    //    document.onload=()=>{
    //     expiry=document.getElementById('expiry')
    //     expiry.min='2021-01-01'
    //     expiry.min='2024-12-31'
    //    }    
    </script>
</body>
</html>